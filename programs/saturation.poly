read_input_data out O[N] par i in 0:N-1 O[i] = (int8)0

clamp in fin out iout
{
    case 
    (fin < 0.0)     {iout = 0}
    (fin > 255.0)   {iout = 255}
    otherwise      {iout = (int8)fin}
}

gray in yin out yout, uout, vout
{
    yout = yin
    uout = 128
    vout = 128
}

extrapolate in source1, degenarate1, source2, degenerate2, source3, degenerate3, alpha 
  out result1, result2, result3
{
    var intermediate = ((1.0 - ((alpha / 255.0) - 1.0))
			* (float32) source1)
                           +
                           (((alpha / 255.0) - 1.0)
                            * (float32) degenerate1)
    result1 = clamp (intermediate)

    intermediate = ((1.0 - ((alpha / 255.0) - 1.0))
			* (float32) source2)
                           +
                           (((alpha / 255.0) - 1.0)
                            * (float32) degenerate2)

    result2 = clamp (intermediate)
    intermediate = ((1.0 - ((alpha / 255.0) - 1.0))
			* (float32) source3)
                           +
                           (((alpha / 255.0) - 1.0)
                            * (float32) degenerate3)

      result3 = clamp (intermediate)
}

yuvtorgb in yin,  uin,  vin out rout, gout, bout
{
    var ydash = ((float32) yin - 16.0) / 219.0
    var udash = ((float32) uin - 128.0) / 224.0
    var vdash = ((float32) vin) - 128.0) / 224.0
    var interr = (255.0 * (ydash + (1.402 * vdash)))
    var interg = (255.0 * (ydash - (0.344136 * udash) - (0.714136 * vdash)))
    var interb = (255.0 * (ydash + (1.772 * udash)))

    rout = clamp (interr)
    gout = clamp (interg)
    bout = clamp (interb)
}

rgbtoyuv in  rin,  gin,  bin out yout, uout, vout
{
    var rdash = ((float32) rin) / 255.0
    var gdash = ((float32) gin) / 255.0
    var bdash = ((float32) bin) / 255.0
    var ydash = ((0.299 * rdash) + (0.587 * gdash) + (0.114 * bdash))
    var intery = ((ydash * 219.0) + 16.0)
    var udash = (((0.0 - 0.168736) * rdash) + ((0.0 - 0.331264) * gdash) + (0.5 * bdash))
    var vdash = ((0.5 * rdash) - (0.418688 * gdash) - (0.081312 * bdash))
    
    var interu = ((udash * 224.0) + 128.0)
    var interv = ((vdash * 224.0) + 128.0)

    yout = clamp (intery)
    uout = clamp (interu)
    vout = clamp (interv)
}

gray_yuvtorgb 

in
    origy[height][width]
out
    greyr[height][width]
    greyg[height][width]
    greyb[height][width]
{
  var greyy
  var greyu
  var greyv

  par i in 0:height-1
   par j in 0:width-1 {
    (greyy, greyu, greyv) = gray (origy) 
    (greyr[i][j], greyg[i,j], greyb[i][j]) = yuvtorgb (greyy,greyu,greyv) 
   }
}

MAIN
in
    origy[height][width],
    origu[height/2][width/2],
    origv[height/2][width/2]
out
    saty[height][width],
    satu[height/2][width/2],
    satv[height/2][width/2]
{
        var alpha = 0.5
        
	 (var greyr[height][width], var grayg[height][width], var grayb[height][width]) = gray_yuvtorgb (origy) 

	 var origy[height][width]
	 var origr[height][width]
	 var origg[height][width]

	  par i in o:height-1
	   par j in 0:width-1
	    (origr[i][j], origg[i][j], origb[i][j]) = yuvtorgb (origy[i,j],origu[(i/2),(j/2)],origv[(i/2),(j/2)]) 

	 (var satr, var satg, var satb) = extrapolate (origr,greyr,origg,greyg,origb,greyb,alpha)
	 (saty,satu,satv) = rgbtoyuv (satr,satg,satb) 

}

main entry
{
    var height = 720
    var weight = 1280
    int8 origy[height][width] = read_input_data()
    int8 origu[height][width] = read_intpu_data()
    int8 origv[height][width] = read_intpu_data()
    int8 saty[(height/2)][(width/2)] = read_input_data()
    int8 satu[(height/2)][(width/2)] = read_intpu_data()
    int8 satv[(height/2)][(width/2)] = read_intpu_data()

    (var saty[height][width], var satu[height/2][width/2], var satv[height/2][width/2]) = MAIN (origy,origu,origv) 
}
